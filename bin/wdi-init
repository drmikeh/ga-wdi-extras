#!/bin/bash

TEST_MODE=false
if [ "$(whoami)" == 'drmikeh' ]; then
  TEST_MODE=true
fi

if $TEST_MODE ; then
  BASE_DIR=~/tmp2
else
  BASE_DIR=~
fi

VERSION=0.1.3
WDI_DIR=$BASE_DIR/ga/wdi
WDI_CLASSWORK_REPO=https://github.com/ga-students/WDI-ATL-4-Classwork

#
# Print a message and quit
#

abort() {
  echo $@
  exit 1
}

#
# Prompt the user to confirm
#

confirm() {
  echo $1
  read -r -p "Are you sure? [y/N] " response
  if [[ $response =~ ^([yY][eE][sS]|[yY])$ ]] ; then
    echo
  else
    abort 'aborting'
  fi
}

create_dir() {
  echo "==> Creating directory $1"
  mkdir -p $1
}

git_clone() {
  git clone $1 $WDI_DIR/classwork
}

#
# Main Script
#

while [[ $# > 0 ]]
do
  key="$1"

  case $key in
    -v|--version)
    echo "wdi-init $VERSION"
    exit 0
    ;;

    -h|--help)
    echo "Usage: wdi-init [-v] [-h]"
    echo "General options:"
    echo "  -v, --version  # Print the version information"
    echo "  -h, --help     # Print usage and options"
    exit 0
    ;;

    *)
    echo "Unrecognized option: $key"
    exit 0
    ;;
  esac
done

echo "==> Creating the directory structure for the GA WDI Class."
echo "==> This script is non-destructive. It will simply add directories where needed."
echo
create_dir $WDI_DIR
create_dir $WDI_DIR/projects
create_dir $WDI_DIR/projects/project_1
create_dir $WDI_DIR/projects/project_2
create_dir $WDI_DIR/projects/project_3
create_dir $WDI_DIR/projects/project_4
git_clone $WDI_CLASSWORK_REPO

if $TEST_MODE ; then
  echo
  echo "==> Results of find"
  find $BASE_DIR | grep -v .git
  echo
  echo "==> Contents of Classwork README.md"
  cat $WDI_DIR/classwork/README.md
fi

echo

#
# Cleanup
#
if $TEST_MODE ; then
  echo "==> Cleanup"
  echo "==> Removing $WDI_DIR"
  rm -rf $WDI_DIR
fi

echo "==> All done!"
